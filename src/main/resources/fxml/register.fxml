<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.Cursor?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.PasswordField?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.effect.ColorAdjust?>
<?import javafx.scene.effect.Glow?>
<?import javafx.scene.effect.InnerShadow?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<StackPane style="-fx-background-color: linear-gradient(to bottom, #1a3a5f, #2a5f8f);" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.tourism.controllers.RegisterController">

   <!-- Main Content Container -->
   <ScrollPane fitToWidth="true" hbarPolicy="NEVER" style="-fx-background: transparent; -fx-background-color: transparent;" vbarPolicy="AS_NEEDED">
      <content>
         <VBox alignment="CENTER" spacing="20" style="-fx-min-height: 1080;">
            <padding>
               <Insets bottom="50" left="50" right="50" top="50" />
            </padding>

            <!-- Registration Card -->
            <VBox alignment="CENTER" maxWidth="800" style="-fx-background-color: white; -fx-background-radius: 15; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.2), 20, 0, 0, 10);">
               <padding>
                  <Insets bottom="40" left="50" right="50" top="40" />
               </padding>

               <children>
                  <!-- Header Section -->
                  <VBox alignment="CENTER" spacing="10">
                     <ImageView fitHeight="80" fitWidth="80" preserveRatio="true">
                        <image>
                           <Image url="@/images/_.jpeg" />
                        </image>
                     </ImageView>
                     <Label style="-fx-text-fill: #1a3a5f; -fx-font-weight: bold;" text="SignUP">
                        <font>
                           <Font size="25.0" />
                        </font>
                     </Label>
                     <Label style="-fx-text-fill: #666; -fx-font-size: 20;" text="Start your legacy journey today!" />
                  </VBox>

                  <!-- Form Sections -->
                  <VBox maxWidth="700" spacing="25" style="-fx-padding: 20 0 0 0;">

                     <!-- Basic Information Section -->
                     <VBox spacing="10" style="-fx-background-color: #f8fafc; -fx-padding: 25; -fx-background-radius: 10; -fx-border-color: #e2e8f0; -fx-border-width: 1; -fx-border-radius: 10;">

                        <!-- Username -->
                        <Label style="-fx-text-fill: #4a5568; -fx-font-size: 14;" text="Username *" />
                        <TextField fx:id="usernameField" promptText="3-20 chars (letters, numbers, _)" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                           <tooltip>
                              <Tooltip text="Must be 3-20 characters, can contain letters, numbers and underscores"/>
                           </tooltip>
                           <cursor>
                              <Cursor fx:constant="TEXT" />
                           </cursor>
                           <effect>
                              <InnerShadow />
                           </effect>
                        </TextField>
                        <Label fx:id="usernameError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />

                        <!-- Full Name -->
                        <Label style="-fx-text-fill: #4a5568; -fx-font-size: 14;" text="Full Name *" />
                        <TextField fx:id="fullNameField" promptText="Your full name (letters and spaces)" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                           <tooltip>
                              <Tooltip text="Must be 3-50 alphabetic characters with spaces"/>
                           </tooltip>
                           <cursor>
                              <Cursor fx:constant="TEXT" />
                           </cursor>
                           <effect>
                              <InnerShadow />
                           </effect>
                        </TextField>
                        <Label fx:id="fullNameError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />

                        <!-- Password -->
                        <Label style="-fx-text-fill: #4a5568; -fx-font-size: 14;" text="Password *" />
                        <PasswordField fx:id="passwordField" promptText="Min 8 chars with uppercase, lowercase, number &amp; special char" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                           <tooltip>
                              <Tooltip text="Must contain:&#10;- At least 8 characters&#10;- One uppercase letter&#10;- One lowercase letter&#10;- One number&#10;- One special character (@#$%^&amp;+=)"/>
                           </tooltip>
                           <cursor>
                              <Cursor fx:constant="TEXT" />
                           </cursor>
                           <effect>
                              <InnerShadow />
                           </effect>
                        </PasswordField>
                        <Label fx:id="passwordError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />

                        <!-- Confirm Password -->
                        <Label style="-fx-text-fill: #4a5568; -fx-font-size: 14;" text="Confirm Password *" />
                        <PasswordField fx:id="confirmPasswordField" promptText="Re-enter your password" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                           <tooltip>
                              <Tooltip text="Must match the password above exactly"/>
                           </tooltip>
                           <cursor>
                              <Cursor fx:constant="TEXT" />
                           </cursor>
                           <effect>
                              <InnerShadow />
                           </effect>
                        </PasswordField>
                        <Label fx:id="confirmPasswordError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />

                        <!-- Email -->
                        <Label style="-fx-text-fill: #4a5568; -fx-font-size: 14;" text="Email *" />
                        <TextField fx:id="emailField" promptText="example@domain.com" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                           <tooltip>
                              <Tooltip text="Must be a valid email address (e.g., user@example.com)"/>
                           </tooltip>
                           <cursor>
                              <Cursor fx:constant="TEXT" />
                           </cursor>
                           <effect>
                              <InnerShadow />
                           </effect>
                        </TextField>
                        <Label fx:id="emailError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />

                        <!-- Phone -->
                        <Label style="-fx-text-fill: #4a5568; -fx-font-size: 14;" text="Phone *" />
                        <TextField fx:id="phoneField" promptText="7-15 digits only" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                           <tooltip>
                              <Tooltip text="Must be 7-15 digits (no spaces or special characters)"/>
                           </tooltip>
                           <cursor>
                              <Cursor fx:constant="TEXT" />
                           </cursor>
                           <effect>
                              <InnerShadow />
                           </effect>
                        </TextField>
                        <Label fx:id="phoneError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />
                        <effect>
                           <Glow level="0.4" />
                        </effect>
                     </VBox>

                     <!-- Role Selection Section -->
                     <VBox spacing="15" style="-fx-background-color: #f0f9ff; -fx-padding: 25; -fx-background-radius: 10; -fx-border-color: #bae6fd; -fx-border-width: 1; -fx-border-radius: 10;">
                        <Label style="-fx-text-fill: #0369a1; -fx-font-weight: bold; -fx-font-size: 16;" text="Select Your Account Type" />

                        <VBox opacity="0.82" spacing="10">
                           <Label style="-fx-text-fill: #0369a1; -fx-font-size: 14;" text="Select Here *" />
                           <ComboBox fx:id="roleComboBox"  onAction="#validateRole" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                              <tooltip>
                                 <Tooltip text="Select whether you're registering as a tourist or guide"/>
                              </tooltip>

                           </ComboBox>
                           <Label fx:id="roleError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />
                           <cursor>
                              <Cursor fx:constant="HAND" />
                           </cursor>
                           <effect>
                              <ColorAdjust brightness="0.24" contrast="-0.31" hue="0.43" saturation="-0.09">
                                 <input>
                                    <Glow />
                                 </input>
                              </ColorAdjust>
                           </effect>
                        </VBox>
                     </VBox>

                     <!-- Role-Specific Section (Initially Hidden) -->
                     <VBox fx:id="roleSpecificSection" managed="false" spacing="15" style="-fx-background-color: #f0fdf4; -fx-padding: 25; -fx-background-radius: 10; -fx-border-color: #86efac; -fx-border-width: 1; -fx-border-radius: 10;" visible="false">

                        <Label fx:id="roleSpecificLabel" style="-fx-text-fill: #15803d; -fx-font-weight: bold; -fx-font-size: 16;" text="Additional Information" />

                        <!-- Tourist Fields -->
                        <VBox fx:id="touristFields" managed="false" spacing="10" visible="false">
                           <Label fx:id="nationalityLabel" style="-fx-text-fill: #15803d; -fx-font-size: 14;" text="Nationality *" />
                           <TextField fx:id="nationalityField" promptText="Country name (3-50 letters)" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                              <tooltip>
                                 <Tooltip text="Your country of origin (alphabetic characters only)"/>
                              </tooltip>
                           </TextField>
                           <Label fx:id="nationalityError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />
                        </VBox>

                        <!-- Guide Fields -->
                        <VBox fx:id="guideFields" managed="false" spacing="10" visible="false">
                           <Label fx:id="languagesLabel" style="-fx-text-fill: #15803d; -fx-font-size: 14;" text="Languages *" />
                           <TextField fx:id="languagesField" promptText="English, Nepali, Hindi, etc." style="-fx-pref-height: 40; -fx-background-radius: 5;">
                              <tooltip>
                                 <Tooltip text="Enter languages you speak, separated by commas"/>
                              </tooltip>
                           </TextField>
                           <Label style="-fx-text-fill: #64748b; -fx-font-size: 12; -fx-font-style: italic;" text="Enter languages separated by commas" />
                           <Label fx:id="languagesError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />

                           <Label fx:id="experienceLabel" style="-fx-text-fill: #15803d; -fx-font-size: 14;" text="Experience (years) *" />
                           <TextField fx:id="experienceField" promptText="0-50 years" style="-fx-pref-height: 40; -fx-background-radius: 5;">
                              <tooltip>
                                 <Tooltip text="Years of experience as a guide (0-50)"/>
                              </tooltip>
                           </TextField>
                           <Label fx:id="experienceError" style="-fx-text-fill: red; -fx-font-size: 12;" visible="false" />
                        </VBox>

                        <effect>
                           <Glow />
                        </effect>
                        <cursor>
                           <Cursor fx:constant="TEXT" />
                        </cursor>
                     </VBox>
                  </VBox>

                  <!-- Action Buttons -->
                  <HBox alignment="CENTER" spacing="20" style="-fx-padding: 30 0 0 0;">
                     <Button fx:id="registerButton" onAction="#handleRegister" style="-fx-background-color: #2563eb; -fx-text-fill: white; -fx-font-weight: bold; -fx-pref-width: 200; -fx-pref-height: 45; -fx-font-size: 16; -fx-background-radius: 25; -fx-effect: dropshadow(three-pass-box, rgba(37,99,235,0.3), 10, 0, 0, 5);" text="Create Account">
                        <tooltip>
                           <Tooltip text="Click to register after filling all fields"/>
                        </tooltip>
                     </Button>

                     <Button fx:id="backButton" style="-fx-background-color: transparent; -fx-text-fill: #64748b; -fx-border-color: #64748b; -fx-border-width: 1; -fx-border-radius: 25; -fx-pref-width: 150; -fx-pref-height: 45; -fx-font-size: 14;" text="Back to Login">
                        <tooltip>
                           <Tooltip text="Return to login screen"/>
                        </tooltip>
                     </Button>
                  </HBox>
               </children>
            </VBox>
         </VBox>
      </content>
   </ScrollPane>
</StackPane>